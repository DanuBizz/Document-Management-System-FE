<!-- Container to utilize data once data$ has been fetched -->
<ng-container *ngIf="data$ | async as data">
    <div class="container">
        <!-- Title -->
        <h1 class="text-center mobile-title">{{ title }}t</h1>

        <!-- Buttons for actions -->
        <div class="d-flex justify-content-center mobile-without-title mb-4">
            <!-- Button to create new document -->
            <app-fab-button icon="add" tooltip="Neues Dokument erstellen"
                            (click)="createNewDocument()"></app-fab-button>

            <!-- Button to create new version -->
            <button
                    mat-mini-fab
                    color="primary"
                    matTooltip="Neue Version erstellen"
                    matTooltipPosition="above"
                    [matTooltipShowDelay]="500"
                    [disabled]="selection.selected.length === 0"
                    (click)="createNewVersion()"
                    class="mx-2"
                    id="test-new-version-button">
                <mat-icon>library_add</mat-icon>
            </button>

            <!-- Button to open in browser. Not implemented yet -->
            <button
                    mat-mini-fab
                    color="primary"
                    matTooltip="Im Browser Ã¶ffnen"
                    matTooltipPosition="above"
                    [matTooltipShowDelay]="500"
                    [disabled]="selection.selected.length === 0"
                    class="mx-2"
                    id="test-open-browser-button">
                <mat-icon>open_in_browser</mat-icon>
            </button>
        </div>

        <!-- scrolling container for the table -->
        <div class="mat-elevation-z10 mb-2">
            <div class="scrolling-container">
                <!-- Progress bar: displayed while data is being fetched -->
                <mat-progress-bar mode="indeterminate" *ngIf="data.isLoading" color="accent"></mat-progress-bar>

                <!-- Table -->
                <table
                        mat-table
                        class="default-table-design"
                        [dataSource]="data.document"
                        matSort
                        matSortActive="id"
                        matSortDirection="asc"
                        multiTemplateDataRows>
                    <!-- Select column -->
                    <ng-container matColumnDef="select" sticky>
                        <th mat-header-cell *matHeaderCellDef>
                            <mat-icon>add_task</mat-icon>
                        </th>
                        <td mat-cell *matCellDef="let document" (click)="$event.stopPropagation()">
                            <mat-checkbox
                                    (change)="onDocumentToggled(document)"
                                    [checked]="selection.isSelected(document)"></mat-checkbox>
                        </td>
                    </ng-container>

                    <!-- ID column -->
                    <ng-container matColumnDef="id" sticky>
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
                        <td mat-cell *matCellDef="let document">
                            {{ document.id }}
                        </td>
                    </ng-container>

                    <!-- Name column -->
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef>Name</th>
                        <td mat-cell *matCellDef="let document">
                            {{ document.name }}
                        </td>
                    </ng-container>

                    <!-- Categories column -->
                    <ng-container matColumnDef="categories">
                        <th mat-header-cell *matHeaderCellDef>Kategorie</th>
                        <td mat-cell *matCellDef="let document">
                            {{ document.categoryIds }}
                        </td>
                    </ng-container>

                    <!-- Expanded detail column -->
                    <ng-container matColumnDef="expandedDetail">
                        <td mat-cell *matCellDef="let document" colspan="5" class="px-0">
                            <table
                                    mat-table
                                    class="documents-table inner-table"
                                    [dataSource]="data.document"
                                    matSort
                                    matSortActive="id"
                                    matSortDirection="asc"
                                    multiTemplateDataRows>
                                <!-- Select column inside expanded detail -->
                                <ng-container matColumnDef="select" sticky>
                                    <th mat-header-cell *matHeaderCellDef>
                                        <mat-icon>add_task</mat-icon>
                                    </th>
                                    <td mat-cell *matCellDef="let document" (click)="$event.stopPropagation()">
                                        <mat-checkbox (change)="onDocumentToggled(document)"
                                                      [checked]="selection.isSelected(document)">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>

                                <!-- ID column inside expanded detail -->
                                <ng-container matColumnDef="id" sticky>
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
                                    <td mat-cell *matCellDef="let document">
                                        {{ document.id }}
                                    </td>
                                </ng-container>

                                <!-- Name column inside expanded detail -->
                                <ng-container matColumnDef="name">
                                    <th mat-header-cell *matHeaderCellDef>Name</th>
                                    <td mat-cell *matCellDef="let document">
                                        {{ document.name }}
                                    </td>
                                </ng-container>

                                <!-- Categories column inside expanded detail -->
                                <ng-container matColumnDef="categories">
                                    <th mat-header-cell *matHeaderCellDef>Kategorie</th>
                                    <td mat-cell *matCellDef="let document">
                                        {{ document.categoryIds }}
                                    </td>
                                </ng-container>

                                <!-- Row definition for expanded detail -->
                                <tr
                                        mat-row
                                        *matRowDef="let document; columns: displayedColumns"
                                        (click)="onToggleDocument(document)"></tr>
                            </table>
                        </td>
                    </ng-container>

                    <!-- Header row definition -->
                    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>

                    <!-- Row definition -->
                    <tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="onToggleDocument(row)"></tr>

                    <!-- Expanded detail row definition -->
                    <tr
                            mat-row
                            *matRowDef="let row; columns: ['expandedDetail']"
                            [class.collapsed-detail]="row !== expandedDocument"></tr>
                </table>
            </div>

            <!-- Paginator -->
            <mat-paginator [length]="data.totalElements"
                           [pageSize]="paginationConfigService.getPageSize()"
                           [pageSizeOptions]="paginationConfigService.getPageSizeOptions()"
                           (page)="handlePageEvent($event)"
                           [showFirstLastButtons]="true"
                           aria-label="Select page of documents"
            >
            </mat-paginator>
        </div>
    </div>
</ng-container>
